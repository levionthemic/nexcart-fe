# NexCart AI Working Notes

- **App shell**: Next.js App Router (v15) with root providers in [src/app/layout.tsx](src/app/layout.tsx): `ThemeProvider`, persisted Redux, socket context, loading context, and global `Toaster`. Roboto via `next/font`.
- **Run/build**: use `npm run dev` (Turbopack), `npm run build`, `npm start`, `npm run lint` per [package.json](package.json).
- **Env contract**: [src/config.ts](src/config.ts) zod-validates required envs (`NEXT_PUBLIC_API_ENDPOINT`, `NEXT_PUBLIC_SOCKET_URL`, GHN, Google IDs). App throws early if missing/invalid.
- **HTTP client**: [src/lib/http.ts](src/lib/http.ts) wraps `fetch` returning `{status,message,data}`. Adds `Authorization` & `X-Session-ID` from cookies on the client, defaults `baseUrl` to `NEXT_PUBLIC_API_ENDPOINT`, and `credentials: include`. If API returns `status === 410`, it refreshes tokens then retries queued requests. Non-OK responses throw `HttpError`.
- **401 handling**: wrap API promises in `asyncHandler` ([src/utils/asyncHandler.ts](src/utils/asyncHandler.ts)) to auto-dispatch `logoutUserAction` and clear cart when a `HttpError` has `status === 401`.
- **API modules**: under [src/apis](src/apis) functions call `http` and usually return `response.data`. Example: auth login/refresh flows in [src/apis/auth.api.ts](src/apis/auth.api.ts); orders CRUD/cluster in [src/apis/order.api.ts](src/apis/order.api.ts). Keep new APIs consistent: pure data return, no component concerns.
- **State management**: Redux Toolkit + redux-persist in [src/redux/store.ts](src/redux/store.ts) persisting `user`, `cart`, `notification`. Providers set up in [src/components/providers/persist-provider.tsx](src/components/providers/persist-provider.tsx); `injectStore` lets non-component helpers dispatch.
- **Sockets**: Notification namespace client in [src/lib/socket.ts](src/lib/socket.ts) using `NEXT_PUBLIC_SOCKET_URL`. Context in [src/components/providers/socket-provider.tsx](src/components/providers/socket-provider.tsx) connects when `currentUser` exists, joins room on `connect`, and cleans up. Use `useSocket` hook ([src/hooks/use-socket.ts](src/hooks/use-socket.ts)) inside providers tree.
- **Middleware & roles**: [src/middleware.ts](src/middleware.ts) guards `/seller`, `/checkout`, `/user` routes via JWT (`access_token` cookie, `ACCESS_TOKEN_SECRET_SIGNATURE`). Redirects to `/login` if missing/invalid or `/403` when role mismatch (seller-only).
- **Constants & helpers**: Global values (API roots, pagination defaults, order status labels, placeholder image) live in [src/utils/constants.ts](src/utils/constants.ts). Utility helpers in [src/utils/helpers.ts](src/utils/helpers.ts) cover GHN address string building (calls `ghn.api`), notification messages, SKU generation, date categorization, and `objectToFormData` for uploadable payloads.
- **UI patterns**: Uses Radix-based UI kit under `src/components/ui`, custom table/rating, etc.; keep styling aligned with existing components instead of raw HTML. Toasts via `sonner` Toaster already mounted.
- **Auth flow notes**: Login APIs return `access_token` + `session_id`; cookies are read client-side by `http`. Refresh via `/auth/refresh-token` uses `credentials: include`. Remember seller vs buyer role logic enforced in middleware and likely in UI.
- **Loading feedback**: `LoadingProvider` in [src/contexts/loading-context.tsx](src/contexts/loading-context.tsx) exposes `startLoading/endLoading` counters—use to track API inflight state instead of local booleans when global feedback is needed.
- **Notifications**: Notification types map to titles/messages in helpers; socket provider emits `join-room` after connect—reuse that channel for real-time updates.
- **Data shapes**: Domain types live under [src/types](src/types); enums (e.g., `OrderStatus`, `Role`) drive UI labels via mappings in constants/helpers—reuse those enums rather than literals.

Feel free to ask if any areas need more depth or if you spot patterns I missed.